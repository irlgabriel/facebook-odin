
<div class='col-6'>

  <!-- Form for creating posts on the feed -->

  <div class='bg-white py-3 mt-4 border-radius-10'>
    <%= form_for @post do |f| %>
      <%= f.text_field :body, placeholder: "What is on your mind, #{current_user.last_name}?", class:'w-90 mx-auto bg-light form-control border-radius-40 border-0'%>
    <% end %>
    <hr class='w-90 mb-1'>
  </div>

  <!-- Actual feed posts -->

  <% @posts.each do |post| %>
    <div class='card my-4 border-radius-10'>
      <div class='card-body'>
        
        <h4 class='card-title'><%= link_to post.author.fullname, profile_path(post.author), class:'text-dark' %></h4>
        <p class='text-muted'><%= distance_of_time_in_words(post.created_at, Time.now) %></p>
        <p class='card-text'><%= post.body %></p>

        <!-- buttons for the author of the post -->

        <% if current_user == post.author %>
          <div class='card-text card-author-buttons text-right'>
            <%= link_to 'Delete', post, method: :delete, data: {confirm: 'Are you sure you want to delete this post?'}, class: 'btn btn-outline-white'%>
            <%= link_to 'Edit', edit_post_path(post), data: {toggle: 'collapse', target: '#post_edit_form'}, class: 'btn btn-outline-white' %>

            <!-- post edit form collapsable -->
            <div class='collapse' id='post-edit-form'>
              <%= form_for post do |f| %>
                <%= f.text_area :body, class:'form-control' %>
                <%= f.submit :save %>
              <% end %>
            </div>
          </div>
        <% end %>

        <!-- number of likes and comments -->
        <div class='d-flex justify-content-between'>
          <div class='card-text my-2'>
            <i class="fas fa-thumbs-up" style='color: blue; font-size: 18px;'>&nbsp;</i>
            <span><%= post.likes %></span>
          </div>
          <p class='card-text text-muted'><%= post.comments.count %> Comments</p>
        </div>

        <!-- buttons for likes and comments -->
        <div class='row border-top border-bottom py-1 mx-auto' style='width: 99%'>
          <%= link_to 'Like', '#', class:'font-weight-bold p-1 border-rounded-10 gray-hover btn btn-outline-white col-6' %>
          <%= link_to 'Comment', '#', class:'font-weight-bold p-1 border-rounded-10 gray-hover btn btn-outline-white col-6',
          data: {toggle: 'collapse', target: "#comments-collapsable#{post.id}"} %>
        </div>

        <!-- comments count - dont show if 0 comments -->
        <div class='my-2'>
          <% unless post.comments.count == 0 %>     
          <%= link_to 'View comments', '#', data:{ toggle:'collapse', target:"#comments-collapsable#{post.id}"}, class: 'font-weight-bold text-muted' %>
          <% end %>
        </div>
        
        <!-- collapsable commments div with form (facebook layout) -->

        <div id=<%="comments-collapsable#{post.id}"%> class='collapse'>

          <!-- comments list -->

          <% post.comments.each do |comment| %>
          <div class='p-2 my-3 bg-light border-radius-20'>
            <h5><%= link_to comment.author.fullname, profile_path(comment.author), class:'text-muted'%></h5>
            <p id='post-comment-editable' class='mb-0'><%= comment.body %></p>

            <!-- comment buttons for comment author -->
            <% if comment.author == current_user %>
              <div id='comment-buttons' class='row'>
                <div class='col-8'></div>
                <%= link_to 'Edit', '#', data: { toggle: 'collapse', target: '#comment-edit-form'}, class: 'btn btn-outline-white col-2' %>
                <%= link_to 'Delete', post_comment_path(post, comment), method: :delete, data: { confirm: 'Are you sure you want to delete this comment?'}, class: 'btn btn-outline-white col-2' %>
                <div id='comment-edit-form' class='collapse'>
                  <%= form_for edit_post_comment_path(post, comment) do |f| %>
                    <%= f.text_field :body, class:'form-control' %>
                  <% end %>
                </div>
              </div>
            <% end %>

          </div>
          <% end %>

          <!-- comment form -->
          <%= form_for Comment.new, url: post_comments_path(post) do |f| %>
            <%= f.text_field :body, autofocus: true, placeholder: 'Write a commment...',
             class:'mt-3 border-radius-20 form-control bg-light'%>
            <%= f.submit :save, value: 'Save', class:'btn w-50 mx-auto btn-primary my-2 d-none' %>
          <% end %>

        </div> <!-- end of collapsable comments div -->


      </div>
    </div>
  <% end %>
</div>

<script>
  
</script>